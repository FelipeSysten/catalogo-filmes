<div class="container movie-detail-page">
  <% if notice.present? %>
    <p class="notice"><%= notice %></p>
  <% end %>

  <div class="movie-header">
    <h1 class="movie-title"><%= @movie.title %></h1>
  </div>

  <div class="movie-content-grid">
    <div class="movie-poster-column">
      <% if @movie.poster.attached? %>
        <%= image_tag @movie.poster.variant(resize_to_limit: [400, 600]),
                      alt: @movie.title,
                      class: "movie-detail-poster" %>
      <% else %>
        <div class="placeholder-poster">
          <p>Poster Indisponível</p>
        </div>
      <% end %>
    </div>

    <div class="movie-info-column">
      <p class="movie-meta-item">
        <strong>Sinopse:</strong>
        <span class="movie-synopsis"><%= @movie.synopsis %></span>
      </p>
      <p class="movie-meta-item">
        <strong>Ano de Lançamento:</strong> <%= @movie.release_year %>
      </p>
      <p class="movie-meta-item">
        <strong>Duração:</strong> <%= @movie.duration %> minutos
      </p>
      <p class="movie-meta-item">
        <strong>Diretor:</strong> <%= @movie.director %>
      </p>
      <p class="movie-meta-item">
        <strong>Elenco:</strong>
        <span class="movie-cast"><%= @movie.cast %></span>
      </p>
      <% if @movie.genres.any? %>
        <p class="movie-meta-item">
          <strong>Gêneros:</strong>
          <span class="movie-genres"><%= @movie.genres.map(&:name).join(', ') %></span>
        </p>
      <% end %>


      <div class="movie-actions">
        <% if @movie.user == current_user %>
          <%= link_to "Editar este filme", edit_movie_path(@movie), class: "button button-primary" %>
          <%= button_to "Apagar este filme", @movie, method: :delete, data: { turbo_confirm: "Tem certeza que deseja apagar este filme?" }, class: "button button-danger" %>
        <% end %>
        <%= link_to "Voltar para filmes", movies_path, class: "button button-secondary" %>
      </div>
    </div>
  </div>

  <hr class="section-divider">

  <div class="comments-section">
    <h2>Comentários</h2>

    <% if @comments.any? %>
      <div id="comments-list">
        <% @comments.each do |comment| %>
          <div class="comment-card">
            <p class="comment-meta">
              <strong><%= comment.user ? comment.user.email : comment.name %></strong>
              <small><%= time_ago_in_words(comment.created_at) %> atrás</small>
            </p>
            <p class="comment-content"><%= comment.content %></p>
            <% if comment.user == current_user %>
              <%= button_to "Apagar", movie_comment_path(@movie, comment), method: :delete, data: { turbo_confirm: "Tem certeza que deseja apagar este comentário?" }, class: "button button-link-danger" %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="no-comments-message">Nenhum comentário ainda. Seja o primeiro a comentar!</p>
    <% end %>

    <div class="comment-form-container">
      <%= render 'comments/form', movie: @movie, comment: @comment %>
    </div>
  </div>
</div>