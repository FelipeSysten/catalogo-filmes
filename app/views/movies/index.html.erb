<div class="catalog-page-wrapper">

  <!-- Seção do Cabeçalho e Busca/Filtros -->
  <div class="catalog-hero-section">
    <h1><%= t("movies.index.page_title") %></h1>

    <%= form_tag movies_path, method: :get, class: "full-search-filter-form" do %>

      <div class="search-bar-container">
        <%= text_field_tag :search, params[:search], placeholder: t("movies.index.search_placeholder"), class: "search-input" %>
      </div>

      <div class="filters-container">
        <div class="filter-group">
          <label for="genre-filter"><%= t("movies.index.filter_by_genre") %></label>
          <%= select_tag :genre, options_for_select([
            [t("movies.index.all"), ""]] +
            (defined?(Genre) && Genre.all.any? ? Genre.all.map { |g| [g.name, g.id] } :
            [[t("movies.index.genres.action"), "action"],
             [t("movies.index.genres.drama"), "drama"],
             [t("movies.index.genres.scifi"), "scifi"],
             [t("movies.index.genres.comedy"), "comedy"]]),
            params[:genre]), class: "filter-select", id: "genre-filter" %>
        </div>

        <div class="filter-group">
          <label for="year-filter"><%= t("movies.index.filter_by_year") %></label>
          <%= select_tag :year, options_for_select(
            [[t("movies.index.all"), ""]] +
            (Time.now.year).downto(1900).map { |y| [y, y] }, 
            params[:year]
                      ), class: "filter-select", id: "year-filter" %>
        </div>

        <%= submit_tag t("movies.index.apply_filters"), class: "button-apply-filters" %>
      </div>

    <% end %>
  </div>

  <!-- Seção do Grid de Filmes -->
  <div class="movies-grid-container">
  <div class="movies-grid">
  <% if @movies.any? %>
    <% @movies.each do |movie| %>
      <div class="movie-card">
        <%= link_to movie_path(movie) do %>
          <% if movie.poster.attached? %>
             <%= image_tag movie.poster.variant(resize_to_limit: [300, 450]), alt: movie.title, class: "movie-poster" %>
          <% else %>
             <%= image_tag "placeholder_poster.png", alt: "Placeholder Poster", class: "movie-poster" %>
          <% end %>
        <% end %>
        <div class="movie-info">
          <%= link_to movie.title, movie_path(movie), class:"movie-title" %>
          <p class="movie-meta">
            
            <% genres = movie.respond_to?(:genres) && movie.genres.any? ? movie.genres.map(&:name).join(', ') : t("movies.index.genre_not_informed") %>
            <%= genres %>
            <%= " / #{movie.release_year}" if movie.release_year.present? %>

            
            <%= " / #{movie.respond_to?(:country) && movie.country.present? ? movie.country : t('movies.index.country_not_informed')}" if movie.respond_to?(:country) %>
          </p>
          <p class="movie-meta">
            <%= t("movies.index.direction_label") %><%= movie.respond_to?(:director) && movie.director.present? ? movie.director : t('movies.index.not_informed') %>
          </p>
          <%= link_to t("movies.index.learn_more"), movie_path(movie), class:"button-saiba-mais" %>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class="no-movies-found"><%= t("movies.index.no_movies_found") %></p>
  <% end %>
</div>
  </div>

  <!-- Paginação -->
  <div class="pagination-container">
    <%= paginate @movies if defined?(paginate) %> <%# Protege se Kaminari não estiver ativo ou @movies não for paginável %>
  </div>

    <% if user_signed_in? %>
    <div class="add-movie-section">
      <%= link_to t("movies.index.add_new_movie"), new_movie_path, class: 'button-saiba-mais button-large' %>
    </div>
  <% end %>

</div>